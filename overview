## レッスン１：Polkadotの基本構造
### Polkadotの目的

Polkadotの目的は主に2つです。

①異なるブロックチェーン間をつなぐ「相互互換性（インターオペラビリティ）」を実現すること。ブロックチェーン間でのメッセージやアセットが相互に交換可能になることを意味します。

BitcoinやEthereumなどのブロックチェーンにはこの相互互換性はありません。現在は、BitcoinウォレットからEthereum上のアセットと物々交換できません。そこで、Ethereumの共同創業者・元CTOのGavin Wood氏は、2016年にPolkadotを考案しました。独立したブロックチェーン間でも、相互にコミュニケーションを可能にするプラットフォームを目指しています。

②共有されたセキュリティを維持すること。複数のブロックチェーンを相互接続する際、ネットワーク全体のセキュリティを高い水準で維持するということです。

PolkadotはPoSを採用しています。トークンの価格が上がるほど、ネットワークの軽勢的セキュリティは高まります。Polkadotは異なる複数のブロックチェーンが繋がるプラットフォームです。相互にブロックチェーンをつなげると、全体のセキュリティのレベルは、もっとも経済的セキュリティの低いブロックチェーンに引っ張られてしまいます。どんなチェーンが繋がっても高い水準のセキュリティを保つ必要があるため、Polkadotはリレーチェーンにセキュリティを共有することでこの問題を解決します。


### ポルカドットの構成要素

ポルカドットは、ネットワークの中核を担うリレーチェーンと、リレーチェーンに繋がる複数のパラチェーン、そしてブリッジという3つの要素で主に構成されています。


![Polkadot.networkMediumより](https://ipfs.io/ipfs/QmfJtFUgc6rFeLZYNzCgmA145an4twvtvmayFfbwPfityv "Polkadot")



#### リレーチェーン

    リレーチェーンとは、ポルカドットのメインチェーンです。リレーチェーンに接続したブロックチェーン（パラチェーン）のセキュリティ維持、コンセンサス形成、およびパラチェーン間での相互運用を可能にしています。まさに、ポルカドットの心臓部です。


    リレーチェーンは接続しているパラチェーンにセキュリティを提供し、パラチェーン間のトランザクションの安全を保証する役割です。そのため、リレーチェーンに実装されている機能は最小限に抑えています。例えば、リレーチェーンにはスマートコントラクトの機能はありません。コンセンサス形成やパラチェーンオークションなど、運営（ガバナンス）に関わるトランザクションがおこなわれます。


    Polkadotのセキュリティにおける目標は、ネットワークへの参加者が合理的であれば、BFT耐性が高まることです。リレーチェーンは、選ばれたバリデーターによって維持されます。バリデーターに誤動作もしくは悪意があればスラッシュ（資金の没収）されるため、リレーチェーンのバリデーターは正しく稼働させるインセンティブがあります。


#### パラチェーン


    パラチェーンとは、リレーチェーンに接続しているブロックチェーンです。Ethereumのような汎用的なブロックチェーンの処理は順番におこなわれますが、パラチェーンはリレーチェーンと並行（パラレル）に繋がっており、トランザクションの並列処理が可能となります。これによって、高いスケーリング能力を持つシステムを可能にしています。


    パラチェーンはリレーチェーンでセキュリティを共有していますが、その他はリレーチェーンから独立して個別に任されています。つまり、パラチェーンには専門性を持たせることができます。セキュリティはリレーチェーンで担保されているため、特に経済的セキュリティを高めることが困難な小さな（資金の乏しい）プロジェクトにとっては大きなメリットがあります。裏を返せば、セキュリティを独自に担保できる開発力や資金力のあるプロジェクトは、この点においてはメリットは少ないかもしれません。


    パラチェーンをリレーチェーンに接続するには、基本的にはパラチェーンオークションでスロット（接続する枠）を獲得する必要があります。オークションに参加するためには、DOTが必要となります。フルスロットを落札すると、リレーチェーンの全てのブロックに接続することができます。リレーチェーン全てのブロックに含める必要がない場合は、パラスレッドと呼ばれるブロックごとのスポット利用のような仕組みも用意されています。


#### ブリッジ

他にもポルカドットのリレーチェーンに接続する方法として、ブリッジというものがあります。ポルカドットネットワーク外部のブロックチェーンをブリッジで接続することができるため、2021年3月末では、ブリッジはPolkadotエコシステムをビットコイン、イーサリアム、テゾスなどの外部ブロックチェーンと互換性を持たせるためのものという位置付けで構想されています。


### ネットワークの参加者

Polkadotネットワークの参加者は、４つの役割があります。

①Validator（バリデーター） \
②Collator（コレーター） \
③Nominator（ノミネーター） \
④Fisherman（フィッシャーマン）



![Polkadot.networkより](https://ipfs.io/ipfs/QmctvevVpcDoEVM6xrhy5QB3K888o7dGCio7p4QSBsvHGc "Polkadot")


#### 1. バリデーター

バリデーターはPolkadotネットワークの中で最も重要な役割で、リレーチェーンのネットワークのセキュリティ担当です。バリデーターに成るにはDOTをステークする必要があり、バリデーターになれる数は決まっています。バリデーターの仕事は、コレーターから受け取ったブロックを検証しリレーチェーンに送信すること、リレーチェーンの合意形成のプロセスに参加することの2つです。検証作業の代わりに、報酬を受け取ることができます。万が一、オンラインで機能しなかったり、悪事を働いたりすると報酬が減るもしくはステークした資産を没収される、スラッシュメカニズムがあります。


#### 2. コレーター

コレーターは、パラチェーンのトランザクションをブロックにかき集めてバリデーターに送る役割があります。バリデーターに送ったブロックが検証され、リレーチェーンに格納されると報酬がもらえます。バリデーターと同様、コレーターになるためにはDOTをステークする必要があります。


#### 3. ノミネーター

PolkadotはNPoS(Nominated PoS)を採用しており、仕組みはDPoS(Delegated PoS)とほとんど同じです。ノミネーターは、DOTをステークし、バリデーターを選出する役割です。バリデーターと違い、ノミネーターの数に上限はなく、ブロックの検証などはしません。ノミネーターがサポートするバリデーターが選出されると、ノミネーターに報酬の一部が分配されます。ひとつのバリデーターに対して報酬が分配されるノミネーターは、ステーク量の上位256番目までと決められています。サポートするバリデーターに何人がノミネートしているのか、バリデーターの手数料、ステーク量の割合、ノード運用の実績など、ノミネーターがDOTをステークする際にはさまざまな要素を確認しましょう。


#### 4. フィッシャーマン

フィッシャーマンは、その名の通り漁師のような報酬形態です。ネットワークの監視役として機能します。ネットワークに不正があった場合、バリデーターに報告することでネットワークセキュリティを維持します。不正報告が正しいと報酬がもらえますが、頻繁に大きな不正が起こるとは思えないため、頻度は少ない分、報酬が大きいことが予測できます。


## レッスン２：Polkadotのガバナンス


### DOTトークン

PolkadotのネイティブトークンはDOTです。DOTには、主に3つの用途があります。

①ガバナンスへの参加


    Polkadotの特徴のひとつに、オンチェーンガバナンスがあります。ネットワークやプロトコルに関する投票に使われます。

②ネットワークへの参加（ステーキング）


    ネットワークに参加するためにはDOTをステークする必要があります。

③スロットオークション、パラスレッドの参加


    オークションはDOTで入札します。スロットの落札者のDOTトークンは、スロットの貸出期間中はロックされ、期間が終了しパラチェーンが削除されると返却されます。落札したパラチェーンの利用期間は、最大2年間です。ロックされたDOTは、ステーキングなどの運用ができません。

2021年3月末でDOTの市場規模は34兆円です。PoSを採用するブロックチェーンにとって、トークン価格の上昇は経済的セキュリティを高めることに繋がります。

また、パラチェーンスロットオークションは、DOTがロックされるため投資家にとっては重要なイベントです。DOTの流通量が減るという点と、入札するDOTを貸し出してプロジェクトトークンを受け取るといったクラウドファンディグのような手法も生まれると予想されます。


### コンセンサス

Polkadotのコンセンサスは、ハイブリッドコンセンサスと言われます。コンセンサスとは、リレーチェーンに追加する有効なブロックに同意するプロセスです。Polkadotのハイブリットコンセンサスは、ブロックの生成とファイナリティ形成のメカニズムを分けているという特徴があります。

ブロック生成では、BABE（Blind Assignment for Blockchain Extension）という確率的ファイナリティが採用されています。このメカニズムは、Probable Finality（ファイナリティされた可能性が高い)方式です。ブロックが有効＝絶対に覆らないという保証はないメカニズムで、多くのブロックが連なることによってファイナライズ（100%覆らない）に限りなく近づいて行きます。

一方、ファイナリティ形成では、GRANDPA（GHOST-based Recursive ANcestor Deriving Prefix Agreement）という、ビザンチン将軍問題に耐性のあるアルゴリズムに基づいたProvable Finality（証明可能なファイナリティ）を採用しています。ブロックチェーンの正当性（覆らない）は保証されていますが、ノードの数が増えるほど、新規ブロックの追加に時間がかかるデメリットがあります。GRANDPAでは、3分の2以上のバリデータが承認したブロックのファイナリティを保証しています。つまり、Polkadotのコンセンサスは1/3がビザンチンノードでない限りは安全です。

Polkadotではこのふたつのメカニズムを取り入れること、ブロックチェーンの処理スピードとブロックの正当性を維持しています。


### NPoS

PolkadotではNPoSを採用しています。バリデーターとノミネーターのステーキング合計量が多い順に決められた人数がバリデーターに選出されます。2021年3月末では、DOTのバリデーターは297ノードです。ノミネーターは信頼できるバリデーターを探す必要がありますし、バリデーターはノミネーターの信頼を得る行動をしなければならないインセンティブが設計されています。


#### ステーキングの報酬計算

ノミネーター報酬

＝（バリデーター報酬 − 手数料）×（ステーク額 / プールの合計ステーク額）

ノミネーターの報酬はこのような式で計算できます。バリデーターの報酬は、各バリデータープールに対して平等に配布されるため、ノミネーターはプール内のステーク量の割合が大きい方が報酬は高くなります。また、バリデーターに対してノミネートできる人数は256人までです。こうすることで、特定のバリデーターにノミネートが集中することを防ぎ、ノミネーターはステークを分散させることになります。

通常のPoSでは、バリデーターはランダムもしくはステーク総量の割合で選出され、報酬を得られます。この場合、経済的に豊かな人ほど報酬が得られるため、中央集権的になってしまいます。一方、PolkadotのNPoSでは、ノミネーターとバリデーターがお互いを監視し合う経済的インセンティブを作李、この問題を解決しています。


## レッスン３：Substrate / Cosmosとの比較


### Substrateとは？

Polkadotのメリットやプロジェクトの理解に欠かせないのがSubstrateです。Substrateとは、ブロックチェーンを作るのに必要な機能を組み込んだフレームワークです。Dr. Gavinが新品のMacBookをプレゼンの場で開封し、その場でSubstrateを使ってブロックチェーンを構築するデモンストレーションを披露したこともあります。

厳密に言えば、SubstrateはParity Technology社が開発したフレームワーク・ミドルウェアのようなもので、必ずしもPolkadotのパラチェーンとは同義ではありません。Substrateを使って構築したブロックチェーンは、独立したチェーンとして存在することも可能です。Polkadotとの接続方法は、2通りあります。

①ソロチェーン＋ブリッジ機能

②パラチェーン

これらどちらの方法でもPolkadotと接続することができます。Substrateを使うと、Polkadotと互換性のあるチェーンが簡単に構築できるというわけです。


### Substrateの構成レイヤー

Substrateは3つのレイヤーで構成されています。


![Polkadot.networkより](https://ipfs.io/ipfs/QmfTmvm4WRPGDQ4YKrUrTKZjTEgTu7PKaUbbw36kLomN2V "Polkadot")



⓪Polkadot Core

①Substrate Core

②Substrate Runtime Module Library(SRML)

③Substrate Node

上位ほど自由度は高く、代わりに開発効率は悪くなります。SubstrateはRustで開発されており、ステートマシンはWasmが使われています。①Substrate Coreは、ブロックチェーン構築のための最低限のスケルトン設計と表現されます。必要に応じてCoreを追加、Runtimeをカスタマイズするだけです。②SRMLは、その名の通りライブラリです。Wasmにコンパイルできる言語であれば独自のRuntimeモジュールを開発ができます。既に提供されているモジュールを繋げるだけでRuntimeを実装できます。③Substrate Nodeは、JSONファイルで簡単にチェーンを作ることが可能です。


### PolkadotとCosmosの比較

PolkadotもCosmosもどちらもブロックチェーンのインターオペラビリティを目的としているためよく比較されています。明確な違いを確認しておきましょう（競合になるとは言っていません）。厳密に言えば、CosmosSDKとSubstrateは対にするものではないという議論があるため、ここではCosmosSDKを詳しく説明することは避けておきます。

PolkadotとCosmosの大きな違いは、

①アーキテクチャ

②コンセンサスアルゴリズム

③セキュリティの根拠

④ガバナンス

の４点です。

Polkadotでは、唯一のメインチェーンであるリレーチェーンに各パラチェーンが接続します。一方、Cosmosでは、「ゾーン」と呼ばれる各ブロックチェーンは、中核となるチェーンである「ハブ」を複数持つことができます。そのため、各ゾーンがそれぞれ独自のセキュリティ維持のためバリデーターを置きます。

また、コンセンサスの違いは、Polkadotでは確率的ファイナリティのBASEと証明可能なファイナリティのGRANDPAとのハイブリットで形成されています。一方、Cosmosでは即時ファイナリティを提供するプロトコルであるTendermintコンセンサスを使用しています。つまり、Polkadotはファイナリティが確証されないままチェーンが伸びていくのに対して、Cosmosは一度に1つのブロックを生成してファイナライズをしてチェーンが伸びていきます。

ガバナンス面では、どちらのチェーンもバリデーターが重要な役割を果たします。Polkadotのバリデーターは全て同じ比重となるコンセンサスアルゴリズムであり、ステーク量ではなく活動に関連づけて報酬が分配されます。一方、Cosmosのバリデーターの選出、コンセンサス投票、報酬はステーク量に応じて決定されます。例えば、コンセンサス投票をおこなう場合、バリデーター数の2/3ではなく、ステーク総量の2/3以上が必要となります。


<table>
  <tr>
   <td>
   </td>
   <td><strong>Polkadot</strong>
   </td>
   <td><strong>Cosmos</strong>
   </td>
  </tr>
  <tr>
   <td><strong>アーキテクチャ</strong>
   </td>
   <td>リレーチェーン⇆パラチェーン
   </td>
   <td>ハブ⇆ゾーン
   </td>
  </tr>
  <tr>
   <td><strong>コンセンサス</strong>
   </td>
   <td>BABE & GRANDPA
   </td>
   <td>Tendermint (BFT)
   </td>
  </tr>
  <tr>
   <td><strong>セキュリティの維持</strong>
   </td>
   <td>リレーチェーンで共有
   </td>
   <td>各ゾーンが実装
   </td>
  </tr>
  <tr>
   <td><strong>ガバナンス</strong>
   </td>
   <td>票の重さが平等
   </td>
   <td>ステークベース
   </td>
  </tr>
</table>
